<source>
  @type tail
  path /var/log/syslog
  pos_file /var/log/td-agent/syslog.pos
  read_from_head true
  tag syslog
  <parse>
    @type syslog
    keep_time_key true
  </parse>
</source>

<filter syslog>
  @type grep
  <regexp>
    key ident
    pattern /dnsmasq/
  </regexp>

  <regexp>
    key message
    pattern /query\[.*/
  </regexp>
</filter>

<match syslog.**>
  @type copy

  <store>
    @type file
    path /var/log/td-agent/syslog
    append true
    flush_interval 3
    <format>
      @type ltsv
    </format>
  </store>
  <store>
    @type forward
    <buffer>
      retry_forever true
      retry_type periodic
    </buffer>
    <server>
      name buf-proxy-dev
      host {{ syslog_server }}
    </server>
  </store>
</match>